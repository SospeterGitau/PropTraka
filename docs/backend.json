{
  "entities": {
    "Property": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Property",
      "type": "object",
      "description": "Represents a rental property owned by the business.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Property entity."
        },
        "address": {
          "type": "string",
          "description": "The full address of the property."
        },
        "purchasePrice": {
          "type": "number",
          "description": "The initial purchase price of the property."
        },
        "mortgageDetails": {
          "type": "string",
          "description": "Details about the mortgage on the property (e.g., lender, account number)."
        },
        "currentRentalValue": {
          "type": "number",
          "description": "The current monthly rental value of the property."
        }
      },
      "required": [
        "id",
        "address",
        "purchasePrice",
        "mortgageDetails",
        "currentRentalValue"
      ]
    },
    "Tenant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tenant",
      "type": "object",
      "description": "Represents a tenant renting a property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tenant entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the tenant."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the tenant."
        },
        "email": {
          "type": "string",
          "description": "The email address of the tenant.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the tenant."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone"
      ]
    },
    "RentalPayment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RentalPayment",
      "type": "object",
      "description": "Represents a rental payment made by a tenant for a specific property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RentalPayment entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property. (Relationship: Property 1:N RentalPayment)"
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N RentalPayment)"
        },
        "date": {
          "type": "string",
          "description": "The date the payment was made.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the payment."
        }
      },
      "required": [
        "id",
        "propertyId",
        "tenantId",
        "date",
        "amount"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense related to a specific property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property. (Relationship: Property 1:N Expense)"
        },
        "date": {
          "type": "string",
          "description": "The date the expense was incurred.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "category": {
          "type": "string",
          "description": "The category of the expense (e.g., maintenance, repairs, insurance)."
        },
        "vendor": {
          "type": "string",
          "description": "The vendor the expense was paid to."
        }
      },
      "required": [
        "id",
        "propertyId",
        "date",
        "amount",
        "category",
        "vendor"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents an appointment related to a specific property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Appointment entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property. (Relationship: Property 1:N Appointment)"
        },
        "date": {
          "type": "string",
          "description": "The date of the appointment.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "The description of the appointment."
        }
      },
      "required": [
        "id",
        "propertyId",
        "date",
        "description"
      ]
    },
    "Alert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Alert",
      "type": "object",
      "description": "Represents a smart alert generated by the AI-powered tool.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Alert entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property. (Relationship: Property 1:N Alert)"
        },
        "date": {
          "type": "string",
          "description": "The date the alert was generated.",
          "format": "date-time"
        },
        "message": {
          "type": "string",
          "description": "The message of the alert."
        },
        "type": {
          "type": "string",
          "description": "The type of alert (e.g., maintenance, arrears)."
        }
      },
      "required": [
        "id",
        "propertyId",
        "date",
        "message",
        "type"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/properties/{propertyId}",
        "definition": {
          "entityName": "Property",
          "schema": {
            "$ref": "#/backend/entities/Property"
          },
          "description": "Properties owned by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the properties."
            },
            {
              "name": "propertyId",
              "description": "The ID of the property."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/properties/{propertyId}/tenants/{tenantId}",
        "definition": {
          "entityName": "Tenant",
          "schema": {
            "$ref": "#/backend/entities/Tenant"
          },
          "description": "Tenants related to a specific property, owned by a user. Includes denormalized `ownerId` from the parent property document.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the property."
            },
            {
              "name": "propertyId",
              "description": "The ID of the property."
            },
            {
              "name": "tenantId",
              "description": "The ID of the tenant."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/properties/{propertyId}/rentalPayments/{rentalPaymentId}",
        "definition": {
          "entityName": "RentalPayment",
          "schema": {
            "$ref": "#/backend/entities/RentalPayment"
          },
          "description": "Rental payments made for a specific property, owned by a user. Includes denormalized `ownerId` from the parent property document.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the property."
            },
            {
              "name": "propertyId",
              "description": "The ID of the property."
            },
            {
              "name": "rentalPaymentId",
              "description": "The ID of the rental payment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/properties/{propertyId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Expenses related to a specific property, owned by a user. Includes denormalized `ownerId` from the parent property document.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the property."
            },
            {
              "name": "propertyId",
              "description": "The ID of the property."
            },
            {
              "name": "expenseId",
              "description": "The ID of the expense."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/properties/{propertyId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Appointments related to a specific property, owned by a user. Includes denormalized `ownerId` from the parent property document.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the property."
            },
            {
              "name": "propertyId",
              "description": "The ID of the property."
            },
            {
              "name": "appointmentId",
              "description": "The ID of the appointment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/properties/{propertyId}/alerts/{alertId}",
        "definition": {
          "entityName": "Alert",
          "schema": {
            "$ref": "#/backend/entities/Alert"
          },
          "description": "Alerts related to a specific property, owned by a user. Includes denormalized `ownerId` from the parent property document.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the property."
            },
            {
              "name": "propertyId",
              "description": "The ID of the property."
            },
            {
              "name": "alertId",
              "description": "The ID of the alert."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage rental property data with a focus on scalability, security, and ease of querying. It leverages path-based ownership for private user data and subcollections to organize related entities. The structure ensures authorization independence by avoiding hierarchical `get()` calls in security rules.  Specifically:\n\n*   **/users/{userId}/properties/{propertyId}**: Each user owns properties. This path structure makes ownership clear and simplifies security rules. Tenant, RentalPayment, Expense, Appointment, and Alert subcollections are nested under each property document, and their documents contain a denormalized `ownerId` field, copied from the parent `property`, allowing for authorization independence.\n*   **Authorization Independence**: All subcollections like `tenants`, `rentalPayments`, `expenses`, `appointments`, and `alerts` include a `ownerId` field, copied from the parent `property`. This eliminates the need for `get()` calls in security rules, ensuring atomic operations and easy debugging.\n*   **QAPs (Rules are not Filters)**: Using segregation and path-based ownership, listing operations are secured. Rules can easily check `request.auth.uid == resource.data.ownerId` for all subcollections.\n*   **Data Integrity**: The structure supports data integrity by enforcing clear ownership and relationships. For example, each `rentalPayment` document includes `propertyId` and `tenantId`, maintaining the relationship between these entities."
  }
}